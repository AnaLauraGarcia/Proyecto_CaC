<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Salud Integral - Turnos</title>
    <link rel="icon" href="img/logo.webp">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">
</head>

<body id="app">
    <header class="header" id="header">
        <miheader></miheader>
    </header>
    <main class="main">
        <section class="hero">
            <div class="container">
                <h1>Mis Turnos</h1>
            </div>
        </section>
        <div class="container">
            <div class="content">
                <h4 class="turns-alert">Los turnos solo podrán ser modificados y/o eliminados con no menos de 48 hs
                    de anticipación.</h4>
                <table class="turns-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Especialización</th>
                            <th>Profesional</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaTurnos"></tbody>
                </table>
            </div>
        </div>
    </main>
    <footer class="footer">
        <mifooter></mifooter>
    </footer>
    <script src="https://unpkg.com/vue@next"></script>
    <script src="js/components.js"></script>
    <script src="js/scriptvue.js"></script>
    <script src="js/index.js"></script>
    <script>
        /* Listar turnos */

        const URL = "http://127.0.0.1:5000/"
        //const URL = "https://ianluisnoa.pythonanywhere.com/"

        // Realizamos la solicitud GET al servidor para obtener todos los turnos
        fetch(URL + 'turns')
            .then(function (response) {
                if (response.ok) {
                    return response.json(); // Parseamos la respuesta JSON
                } else {
                    // Si hubo un error, lanzar explícitamente una excepción
                    // para ser "catcheada" más adelante
                    throw new Error('Error al obtener los turnos.');
                }
            })
            .then(function (data) {
                var tablaTurnos = document.getElementById('tablaTurnos');

                // Iteramos sobre los productos y agregamos filas a la tabla
                data.forEach(function (turno) {
                    var fecha = new Date(turno.fecha);
                    var fechaFormatted = fecha.toLocaleDateString('es-ES'); // Formato DD-MM-AAAA

                    var fila = document.createElement('tr');
                    fila.innerHTML = '<td>' + fechaFormatted + '</td>' +
                        '<td>' + turno.hora + '</td>' +
                        '<td>' + turno.especialidad + '</td>' +
                        '<td>' + turno.profesional + '</td>' +
                        '<td class="actions">' +
                        '<button onclick="modificar_turno(\'' + turno.fecha + '\', \'' + turno.hora + '\')">Modificar</button>' +
                        '<button onclick="eliminar_turno(\'' + turno.fecha + '\', \'' + turno.hora + '\')">Eliminar</button>' +
                        '</td>';
                    tablaTurnos.appendChild(fila);
                });

            })
            .catch(function (error) {
                // Código para manejar errores
                alert('Error al obtener los turnos.');
            });

        
        function modificar_turno(fecha, hora) {
            console.log("Modifciar Turno");
        }

        function eliminar_turno(fecha, hora) {
            const url = URL + 'turns/' + fecha + '&' + hora;
            // Eliminamos el turno de la fila seleccionada
            fetch(url, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        // Eliminar el turno de la lista después de eliminarlo en el servidor
                        // Aquí debes implementar el código para actualizar la lista de turnos en tu interfaz
                        console.log('Turno eliminado correctamente.');
                    } else {
                        // Si hubo un error, lanzar explícitamente una excepción
                        // para ser "catcheada" más adelante
                        throw new Error('Error al eliminar el turno.');
                    }
                })
                .catch(error => {
                    // Código para manejar errores
                    alert('Error al eliminar el turno.');
                });
        }
    </script>
</body>

</html>